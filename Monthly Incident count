WITH T1 AS (
    SELECT
        DISTINCT
        A.NUMBER
        ,A.SHORT_DESCRIPTION
        ,A.DESCRIPTION
        ,A.SYS_CREATED_ON
        ,A.CATEGORY
        ,A.SUBCATEGORY
        ,B.LABEL AS INCIDENT_STATE
        ,C.LABEL AS PRIORITY
        ,D.LABEL AS HOLD_REASON
        ,A.ACTIVE
        ,A.CLOSE_NOTES
        ,A.CLOSED_AT
    FROM
        INCIDENT__VIEW A
    LEFT JOIN
        SYS_CHOICE__VIEW B
        ON A.INCIDENT_STATE = B.VALUE AND B.ELEMENT = 'incident_state'
    LEFT JOIN
        SYS_CHOICE__VIEW C
        ON TO_CHAR(A.PRIORITY) = C.VALUE AND C.ELEMENT = 'priority'
    LEFT JOIN
        SYS_CHOICE__VIEW D
        ON TO_CHAR(A.HOLD_REASON) = D.VALUE AND D.ELEMENT = 'hold_reason'
    WHERE
        A.ACTIVE = TRUE
)

SELECT
    YEAR(SYS_CREATED_ON) AS CREATED_YR
    ,MONTH(SYS_CREATED_ON) AS CREATED_MO
    ,INCIDENT_STATE
    ,COUNT(DISTINCT NUMBER) AS CT
FROM
    T1
GROUP BY
    CREATED_YR
    ,CREATED_MO
    ,INCIDENT_STATE
ORDER BY 
    CREATED_YR DESC
    ,CREATED_MO DESC
    ,CT DESC
;
