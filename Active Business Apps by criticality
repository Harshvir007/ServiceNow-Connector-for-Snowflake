WITH T1 AS (
    SELECT
        NAME
        ,SHORT_DESCRIPTION
        ,ACTIVE
        ,APPLICATION_TYPE
        ,APPLICATION_MANAGER
        ,ATTESTED
        ,BUSINESS_CRITICALITY
        ,BUSINESS_UNIT
        ,CATEGORY
        ,SUBCATEGORY
        ,CERTIFIED
        ,DATA_CLASSIFICATION
        ,INSTALL_TYPE
    FROM
        CMDB_CI_BUSINESS_APP__VIEW
    WHERE
        ACTIVE = TRUE
)

SELECT
    BUSINESS_CRITICALITY
    ,COUNT(DISTINCT NAME) AS APP_COUNT
FROM
    T1
GROUP BY
    BUSINESS_CRITICALITY
;
